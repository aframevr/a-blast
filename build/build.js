!function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={exports:{},id:s,loaded:!1};return t[s].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){window.ABLAST={},i(1),i(2),i(3),i(4),i(6),i(7),i(8),i(9),i(10),i(11),i(12),i(13),i(15),i(16),i(17),i(18),i(19),i(20),i(21),i(22),i(23),i(24),i(25),i(26),i(27),i(28),i(29),i(30),i(32),i(33),i(34),i(35),i(36),i(37),i(38),i(39),i(40),i(41),i(42),i(43),i(44),i(45),i(46)},function(t,e){AFRAME.registerElement("a-asset-image",{prototype:Object.create(AFRAME.ANode.prototype,{createdCallback:{value:function(){this.isAssetItem=!0}},attachedCallback:{value:function(){var t=this.getAttribute("src"),e=new THREE.ImageLoader;e.load(t,this.onImageLoaded.bind(this))}},onImageLoaded:{value:function(){AFRAME.ANode.prototype.load.call(this)}}})})},function(t,e){function i(t,e,i){var s=document.createElement("a-mixin");s.setAttribute("id",t),Object.keys(e).forEach(function(t){var i=e[t];"object"==typeof i&&(i=AFRAME.utils.styleParser.stringify(i)),s.setAttribute(t,i)});var n=i?i.querySelector("a-assets"):document.querySelector("a-assets");return n||(n=document.createElement("a-assets"),i.appendChild(n)),n.appendChild(s),s}function s(t,e){var i=Math.floor(Math.random()*e)+t,s=2*Math.random()*Math.PI,n=2*Math.random()-1,o=Math.sqrt(1-n*n),a={x:o*Math.cos(s)*i,y:o*Math.sin(s)*i,z:n*i};return a.y<0&&(a.y=-a.y),a.z>0&&(a.z=-a.z),a}Number.prototype.padLeft=function(t,e){return Array(t-String(this).length+1).join(e||"0")+this},t.exports={createMixin:i,randomPointInSphere:s}},function(t,e){function i(t,e){function i(t){this.material.map=t,this.material.needsUpdate=!0}this.width=e.width,this.height=e.height,this.numSegments=e.numSegments;var n="assets/images/font.png";t.loadTexture(n,{src:n},i.bind(this)),this.material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,color:e.color,transparent:!0}),this.group=new THREE.Group;var o=this.width/this.numSegments;this.numLetters=s.length;for(var a=0;a<this.numSegments;a++)plane=new THREE.Mesh(new THREE.PlaneBufferGeometry(o,this.height),this.material),plane.position.x=a*o,this.group.add(plane)}var s="0123456789:* ";i.prototype={update:function(t){t=t.split("").map(function(t){return s.indexOf(t)});for(var e=1/this.numLetters,i=0;i<this.numSegments;i++){var n=this.group.children[i].geometry.attributes.uv,o=n.array,a=t[i]*e,r=(t[i]+1)*e;o[0]=a,o[4]=a,o[2]=r,o[6]=r,n.needsUpdate=!0}}},t.exports=i},function(t,e,i){var s=i(5);ABLAST.BULLETS={},ABLAST.registerBullet=function(t,e,i){if(ABLAST.BULLETS[t])throw new Error("The bullet `"+t+"` has been already registered. Check that you are not loading two versions of the same bullet or two different bullets of the same name.");ABLAST.BULLETS[t]={poolSize:e.poolSize,components:e.components,definition:i},console.info("Bullet registered ",t)},AFRAME.registerSystem("bullet",{init:function(){var t=this;this.poolHelper=new s("bullet",ABLAST.BULLETS,this.sceneEl),this.activeBullets=[],this.sceneEl.addEventListener("gamestate-changed",function(e){"state"in e.detail.diff&&("STATE_GAME_OVER"!==e.detail.state.state&&"STATE_GAME_WIN"!==e.detail.state.state||t.reset())})},reset:function(t){var e=this;this.activeBullets.forEach(function(t){e.returnBullet(t.getAttribute("bullet").name,t)})},returnBullet:function(t,e){this.activeBullets.splice(this.activeBullets.indexOf(e),1),this.poolHelper.returnEntity(t,e)},getBullet:function(t){var e=this.poolHelper.requestEntity(t);return this.activeBullets.push(e),e}})},function(t,e,i){var s=i(2).createMixin,n=function(t,e,i){this.groupName=t,this.sceneEl=i||document.querySelector("a-scene"),this.initializePools(t,e)};n.prototype={initializePools:function(t,e){var i=this;Object.keys(e).forEach(function(n){var o=e[n],a=o.components,r=t+n;s(r,a,i.sceneEl),i.sceneEl.setAttribute("pool__"+r,{size:o.poolSize,mixin:r,dynamic:!0})})},returnEntity:function(t,e){var i=this.groupName+t,s="pool__"+i;this.sceneEl.components[s].returnEntity(e)},requestEntity:function(t){var e=this.groupName+t,i="pool__"+e,s=this.sceneEl.components[i].requestEntity();return s}},t.exports=n},function(t,e,i){var s=i(5);ABLAST.ENEMIES={},ABLAST.registerEnemy=function(t,e,i){if(ABLAST.ENEMIES[t])throw new Error("The enemy `"+t+"` has been already registered. Check that you are not loading two versions of the same enemy or two different enemies of the same name.");ABLAST.ENEMIES[t]={poolSize:e.poolSize,components:e.components,definition:i,name:t},console.info("Enemy registered ",t)},AFRAME.registerSystem("enemy",{schema:{wave:{"default":0}},init:function(){var t=this,e=this.sceneEl;return e.hasLoaded?(this.poolHelper=new s("enemy",ABLAST.ENEMIES,this.sceneEl),this.activeEnemies=[],void e.addEventListener("gamestate-changed",function(e){if("state"in e.detail.diff)if("STATE_PLAYING"===e.detail.state.state)setTimeout(function(){t.createWave(0)},1e3);else if("STATE_GAME_OVER"===e.detail.state.state||"STATE_GAME_WIN"===e.detail.state.state||"STATE_MAIN_MENU"===e.detail.state.state)return void t.reset();"waveSequence"in e.detail.diff&&t.createSequence(e.detail.state.waveSequence),"wave"in e.detail.diff&&t.createWave(e.detail.state.wave)})):void e.addEventListener("loaded",this.init.bind(this))},getEnemy:function(t){return this.poolHelper.requestEntity(t)},onEnemyDeath:function(t,e){"STATE_MAIN_MENU"===this.sceneEl.getAttribute("gamestate").state?this.sceneEl.emit("start-game"):(this.poolHelper.returnEntity(t,e),this.sceneEl.emit("enemy-death"))},createSequence:function(t){var e=this,i=this.currentWave.sequences[t].start||0;setTimeout(function(){e.currentSequence=t;var i=e.currentWave.sequences[t];i.enemies.forEach(function(t){e.createEnemies(t)})},i)},createWave:function(t){this.currentWave=WAVES[t%WAVES.length],console.log("Creating wave",t),this.createSequence(0),this.sceneEl.emit("wave-created",{wave:this.currentWave})},createEnemy:function(t,e,i){function s(t){t.setAttribute("visible",!0),t.components["curve-movement"].addPoints(e.points),t.play(),n.activeEnemies.push(t),n.sceneEl.emit("enemy-spawn",{enemy:t})}var n=this,o=this.getEnemy(t);o.setAttribute("enemy",{shootingDelay:3e3}),o.setAttribute("curve-movement",{type:e.movement,loopStart:e.loopStart||1,timeOffset:i||0}),i?i<0&&(o.setAttribute("visible",!1),setTimeout(function(){s(o)},-i)):s(o)},createEnemies:function(t){if(Array.isArray(t.type))for(var e=0;e<t.type.length;e++){var i=t.type[e],s=(t.enemyTimeOffset||0)*e;this.createEnemy(i,t,s)}else this.createEnemy(t.type,t)},reset:function(t){var e=this;this.activeEnemies.forEach(function(t){e.poolHelper.returnEntity(t.getAttribute("enemy").name,t)})}})},function(t,e,i){var s=i(5);ABLAST.EXPLOSIONS={},ABLAST.registerExplosion=function(t,e,i){if(ABLAST.EXPLOSIONS[t])throw new Error("The explosion `"+t+"` has been already registered. Check that you are not loading two versions of the same explosion or two different enemies of the same name.");ABLAST.EXPLOSIONS[t]={poolSize:e.poolSize,components:e.components,definition:i,name:t},console.info("Explosion registered ",t)},AFRAME.registerSystem("explosion",{schema:{wave:{"default":0}},init:function(){this.poolHelper=new s("explosion",ABLAST.EXPLOSIONS,this.sceneEl),this.activeExplosions=[],this.sounds={enemy_start:document.getElementById("explosion0"),enemy0:document.getElementById("explosion0"),enemy1:document.getElementById("explosion1"),enemy2:document.getElementById("explosion2"),enemy3:document.getElementById("explosion3"),bullet:document.getElementById("hitbullet"),background:document.getElementById("hitbullet")},this.soundVolumes={enemy_start:.7,enemy0:1,enemy1:1,enemy2:1,enemy3:1,bullet:.4,background:.2}},reset:function(t){var e=this;this.activeExplosions.forEach(function(t){e.returnToPool(t.getAttribute("explosion").name,t)})},returnToPool:function(t,e){this.activeExplosions.splice(this.activeExplosions.indexOf(e),1),this.poolHelper.returnEntity(t,e)},getFromPool:function(t){var e=this.poolHelper.requestEntity(t);return this.activeExplosions.push(e),e},createExplosion:function(t,e,i,s,n,o){var a=this.getFromPool(t);a.setAttribute("position",e||this.el.getAttribute("position")),a.setAttribute("explosion",{type:t,lookAt:n,color:i||"#FFF",scale:s||1}),a.setAttribute("sound",{src:this.sounds[o||t].src,volume:this.soundVolumes[o||t],poolSize:15,autoplay:!0}),a.setAttribute("visible",!0),a.play()}}),ABLAST.registerExplosion("enemy",{components:{explosion:{type:"enemy"}},poolSize:10},{}),ABLAST.registerExplosion("enemygun",{components:{explosion:{type:"enemygun"}},poolSize:10},{}),ABLAST.registerExplosion("bullet",{components:{explosion:{type:"bullet"}},poolSize:10},{}),ABLAST.registerExplosion("background",{components:{explosion:{type:"background"}},poolSize:10},{})},function(t,e){ABLAST.registerBullet("default",{components:{bullet:{name:"default",maxSpeed:1,initialSpeed:.1,acceleration:.4,color:"#24CAFF"},"collision-helper":{debug:!1,radius:.2},"json-model":{src:"#playerBullet"}},poolSize:10},{init:function(){var t=this.el,e=this.bullet.components.bullet.color;t.setAttribute("material","color",e),t.setAttribute("scale",{x:.2,y:.2,z:.2}),this.trail=null;var i=this;t.addEventListener("model-loaded",function(t){i.trail=i.el.getObject3D("mesh").getObjectByName("trail"),i.trail.scale.setY(.001)})},reset:function(){var t=this.el;t.setAttribute("scale",{x:.2,y:.2,z:.2}),this.trail&&this.trail.scale.setY(.001)},tick:function(t,e){if(this.trail&&this.trail.scale.y<1){var i=this.trail.scale.y+e/50;i>1&&(i=1),this.trail.scale.setY(i)}},onHit:function(t){this.el.setAttribute("material","color","#FFF")}})},function(t,e){ABLAST.registerBullet("enemy-slow",{components:{bullet:{name:"enemy-slow",maxSpeed:.5,initialSpeed:.1,acceleration:.03,destroyable:!0,color:"#FFB911"},"collision-helper":{debug:!1,radius:.13},"json-model":{src:"#enemyBullet"}},poolSize:10},{init:function(){var t=this.el,e=this.bullet.components.bullet.color;t.setAttribute("material","color",e),t.setAttribute("scale",{x:.13,y:.13,z:.13}),this.trail=null,this.glow=null;var i=this;t.addEventListener("model-loaded",function(t){t.detail.model.children[0].material.color.setStyle(e),i.trail=i.el.getObject3D("mesh").getObjectByName("trail"),i.trail.scale.setY(.001),i.glow=i.el.getObject3D("mesh").getObjectByName("glow")})},reset:function(){var t=this.el;t.setAttribute("scale",{x:.13,y:.13,z:.13}),this.trail&&this.trail.scale.setY(.001)},tick:function(t,e){if(this.trail&&this.trail.scale.y<.3){var i=this.trail.scale.y+e/1e3;i>.3&&(i=.3),this.trail.scale.setY(i)}if(this.glow){var s=1+.1*Math.sin(t/20);this.glow.scale.set(s,s,s)}},onHit:function(t){}})},function(t,e){ABLAST.registerBullet("enemy-medium",{components:{bullet:{name:"enemy-medium",maxSpeed:.5,initialSpeed:.1,acceleration:.06,destroyable:!0,color:"#FF5533"},"collision-helper":{debug:!1,radius:.16},"json-model":{src:"url(assets/models/enemy-bullet.json)"}},poolSize:10},{init:function(){var t=this.el,e=this.bullet.components.bullet.color;t.setAttribute("material","color",e),t.setAttribute("scale",{x:.16,y:.16,z:.16}),this.trail=null,this.glow=null;var i=this;t.addEventListener("model-loaded",function(t){t.detail.model.children[0].material.color.setStyle(e),i.trail=i.el.getObject3D("mesh").getObjectByName("trail"),i.trail.scale.setY(.001),i.glow=i.el.getObject3D("mesh").getObjectByName("glow")})},reset:function(){var t=this.el;t.setAttribute("scale",{x:.13,y:.13,z:.13}),this.trail&&this.trail.scale.setY(.001)},tick:function(t,e){if(this.trail&&this.trail.scale.y<.3){var i=this.trail.scale.y+e/1e3;i>.3&&(i=.3),this.trail.scale.setY(i)}if(this.glow){var s=1+.1*Math.sin(t/20);this.glow.scale.set(s,s,s)}},onHit:function(t){}})},function(t,e){ABLAST.registerBullet("enemy-fast",{components:{bullet:{name:"enemy-fast",maxSpeed:.1,initialSpeed:.1,acceleration:.1,destroyable:!0,color:"#FF7F00"},"collision-helper":{debug:!1,radius:.1},"json-model":{src:"#enemyBullet"}},poolSize:10},{init:function(){var t=this.el,e=this.bullet.components.bullet.color;t.setAttribute("material","color",e),t.setAttribute("scale",{x:.09,y:.09,z:.09}),this.trail=null,this.glow=null;var i=this;t.addEventListener("model-loaded",function(t){t.detail.model.children[0].material.color.setStyle(e),i.trail=i.el.getObject3D("mesh").getObjectByName("trail"),i.trail.scale.setY(.001),i.glow=i.el.getObject3D("mesh").getObjectByName("glow")})},reset:function(){var t=this.el;t.setAttribute("scale",{x:.09,y:.09,z:.09}),this.trail&&this.trail.scale.setY(.001)},tick:function(t,e){if(this.trail&&this.trail.scale.y<1){var i=this.trail.scale.y+e/1e3;i>1&&(i=1),this.trail.scale.setY(i)}if(this.glow){var s=1+.1*Math.sin(t/10);this.glow.scale.set(s,s,s)}},onHit:function(t){}})},function(t,e){ABLAST.registerBullet("enemy-fat",{components:{bullet:{name:"enemy-fat",maxSpeed:.3,initialSpeed:.1,acceleration:.04,destroyable:!0,color:"#8762FF"},"collision-helper":{debug:!1,radius:.5},"json-model":{src:"#enemyBullet"}},poolSize:10},{init:function(){var t=this.el,e=this.bullet.components.bullet.color;t.setAttribute("material","color",e),t.setAttribute("scale",{x:.5,y:.5,z:.5}),this.trail=null,this.glow=null;var i=this;t.addEventListener("model-loaded",function(t){t.detail.model.children[0].material.color.setStyle(e),i.trail=i.el.getObject3D("mesh").getObjectByName("trail"),i.trail.scale.setY(.001),i.glow=i.el.getObject3D("mesh").getObjectByName("glow")})},reset:function(){var t=this.el;t.setAttribute("scale",{x:.5,y:.5,z:.5}),this.trail&&this.trail.scale.setY(.001)},tick:function(t,e){if(this.trail&&this.trail.scale.y<.1){var i=this.trail.scale.y+e/1e3;i>.1&&(i=.1),this.trail.scale.setY(i)}if(this.glow){var s=1+Math.abs(.4*Math.sin(t/80));this.glow.scale.set(s,s,s)}},onHit:function(t){}})},function(t,e,i){i(14).randomPointInSphere;ABLAST.registerEnemy("enemy_start",{components:{enemy:{name:"enemy_start",color:"#FFB911",scale:.9,health:1},"collision-helper":{debug:!1,radius:.4},"json-model":{src:"url(assets/models/enemy0.json)",texturePath:"url(assets/images/)",singleModel:!0}},poolSize:1},{init:function(){this.shootingDelay=3e3,this.warmUpTime=1e3,this.reset()},reset:function(){var t=this.el,e=this.data.scale;t.addEventListener("model-loaded",function(i){t.getObject3D("mesh").scale.set(e,e,e)}),this.lastShoot=void 0,this.willShootEmited=!1},tick:function(t,e){this.el.components.enemy.willShoot(t,e,this.warmUpTime)},onHit:function(t){}})},function(t,e){function i(t,e,i){var s=document.createElement("a-mixin");s.setAttribute("id",t),Object.keys(e).forEach(function(t){var i=e[t];"object"==typeof i&&(i=AFRAME.utils.styleParser.stringify(i)),s.setAttribute(t,i)});var n=i?i.querySelector("a-assets"):document.querySelector("a-assets");return n||(n=document.createElement("a-assets"),i.appendChild(n)),n.appendChild(s),s}function s(t,e){var i=Math.floor(Math.random()*e)+t,s=2*Math.random()*Math.PI,n=2*Math.random()-1,o=Math.sqrt(1-n*n),a={x:o*Math.cos(s)*i,y:o*Math.sin(s)*i,z:n*i};return a.y<0&&(a.y=-a.y),a.z>0&&(a.z=-a.z),a}Number.prototype.padLeft=function(t,e){return Array(t-String(this).length+1).join(e||"0")+this},String.prototype.pad=function(t,e,i){var s=String(this).substr(0,t),n=Array(t-s.length+1).join(i||" ");return e?n+this:this+n},t.exports={createMixin:i,randomPointInSphere:s}},function(t,e,i){i(14).randomPointInSphere;ABLAST.registerEnemy("enemy0",{components:{enemy:{name:"enemy0",bulletName:"enemy-slow",color:"#FFB911",scale:.9,health:1},"collision-helper":{debug:!1,radius:.4},"json-model":{src:"#enemy0",texturePath:"url(assets/images/)",singleModel:!0}},poolSize:10},{init:function(){this.shootingDelay=3e3,this.warmUpTime=1e3,this.reset()},reset:function(){var t=this.el,e=this.data.scale;this.actualShootingDelay=this.shootingDelay+Math.floor(this.shootingDelay*Math.random()),t.addEventListener("model-loaded",function(i){t.getObject3D("mesh").scale.set(e,e,e)}),this.lastShoot=void 0,this.willShootEmited=!1},tick:function(t,e){if(void 0==this.lastShoot)this.lastShoot=t;else if(t-this.lastShoot>this.actualShootingDelay){var i=this.el.getAttribute("position");i.z<0&&i.y>0&&(this.el.components.enemy.shoot(t,e),this.lastShoot=t,this.willShootEmited=!1,this.actualShootingDelay=this.shootingDelay*(Math.random()<.7?2:1))}else!this.willShootEmited&&t-this.lastShoot>this.actualShootingDelay-this.warmUpTime&&(this.el.components.enemy.willShoot(t,e,this.warmUpTime),this.willShootEmited=!0)},onHit:function(t){}})},function(t,e,i){i(14).randomPointInSphere;ABLAST.registerEnemy("enemy1",{components:{enemy:{name:"enemy1",bulletName:"enemy-fast",color:"#FF7D00",scale:.6,health:1},"collision-helper":{debug:!1,radius:.3},"json-model":{src:"#enemy1",texturePath:"url(assets/images/)",singleModel:!0}},poolSize:10},{init:function(){this.shootingDelay=5e3,this.warmUpTime=1e3,this.reset()},reset:function(){var t=this.el,e=this.data.scale;this.actualShootingDelay=this.shootingDelay+Math.floor(this.shootingDelay*Math.random()),t.addEventListener("model-loaded",function(i){t.getObject3D("mesh").scale.set(e,e,e)}),this.lastShoot=void 0,this.willShootEmited=!1},tick:function(t,e){if(void 0==this.lastShoot)this.lastShoot=t;else if(t-this.lastShoot>this.actualShootingDelay){var i=this.el.getAttribute("position");i.z<0&&i.y>0&&(this.el.components.enemy.shoot(t,e),this.lastShoot=t,this.willShootEmited=!1,this.actualShootingDelay=this.shootingDelay*(Math.random()<.5?2:1))}else!this.willShootEmited&&t-this.lastShoot>this.actualShootingDelay-this.warmUpTime&&(this.el.components.enemy.willShoot(t,e,this.warmUpTime),this.willShootEmited=!0)},onHit:function(t){}})},function(t,e,i){i(14).randomPointInSphere;ABLAST.registerEnemy("enemy2",{components:{enemy:{name:"enemy2",bulletName:"enemy-medium",color:"#FF5533",scale:1.3,health:3},"collision-helper":{debug:!1,radius:.6},"json-model":{src:"#enemy2",texturePath:"url(assets/images/)",singleModel:!0}},poolSize:10},{init:function(){this.shootingDelay=2e3,this.warmUpTime=800,this.reset()},reset:function(){var t=this.el,e=this.data.scale;this.actualShootingDelay=this.shootingDelay+Math.floor(this.shootingDelay*Math.random()),t.addEventListener("model-loaded",function(i){t.getObject3D("mesh").scale.set(e,e,e)}),this.lastShoot=void 0,this.willShootEmited=!1},tick:function(t,e){if(void 0==this.lastShoot)this.lastShoot=t;else if(t-this.lastShoot>this.actualShootingDelay){var i=this.el.getAttribute("position");i.z<0&&i.y>0&&(this.el.components.enemy.shoot(t,e),this.lastShoot=t,this.willShootEmited=!1,this.actualShootingDelay=this.shootingDelay*(Math.random()<.2?2:1))}else!this.willShootEmited&&t-this.lastShoot>this.actualShootingDelay-this.warmUpTime&&(this.el.components.enemy.willShoot(t,e,this.warmUpTime),this.willShootEmited=!0)},onHit:function(t){}})},function(t,e,i){i(14).randomPointInSphere;ABLAST.registerEnemy("enemy3",{components:{enemy:{name:"enemy3",bulletName:"enemy-fat",color:"#8762FF",scale:2.5,health:30},"collision-helper":{debug:!1,radius:1.2},"json-model":{src:"#enemy3",texturePath:"url(assets/images/)",singleModel:!0}},poolSize:4},{init:function(){this.shootingDelay=800,this.warmUpTime=500,this.reset()},reset:function(){var t=this.el,e=this.data.scale;this.actualShootingDelay=this.shootingDelay+Math.floor(this.shootingDelay*Math.random()),t.addEventListener("model-loaded",function(i){t.getObject3D("mesh").scale.set(e,e,e)}),this.lastShoot=void 0,this.willShootEmited=!1},tick:function(t,e){if(void 0==this.lastShoot)this.lastShoot=t;else if(t-this.lastShoot>this.actualShootingDelay){var i=this.el.getAttribute("position");i.z<0&&i.y>0&&(this.el.components.enemy.shoot(t,e),this.lastShoot=t,this.willShootEmited=!1,this.actualShootingDelay=this.shootingDelay*(Math.random()<.3?2:1))}else!this.willShootEmited&&t-this.lastShoot>this.actualShootingDelay-this.warmUpTime&&(this.el.components.enemy.willShoot(t,e,this.warmUpTime),this.willShootEmited=!0)},onHit:function(t){}})},function(t,e,i){i(14).randomPointInSphere;ABLAST.registerEnemy("enemy_static",{components:{enemy:{name:"enemy_static",color:"#FFF"},"collision-helper":{debug:!0,radius:.65},"json-model":{src:"url(assets/models/enemy0.json)",texturePath:"url(assets/images/)",singleModel:!0}},poolSize:10},{init:function(){this.reset()},reset:function(){},tick:function(t,e){},onHit:function(t){}})},function(t,e){function i(t){var e="";return t.forEach(function(t){name=t.name.toLowerCase();var t=t.points.toString().pad(5);e+=t+" "+name+"\n"}),e}AFRAME.registerSystem("highscores",{schema:{maxScores:{"default":10}},init:function(){if(!this.isHighScore())return void console.warn("Highscore can't be loaded or saved as no localStorage support found!");this.scores=[],localStorage.highscores&&(this.scores=JSON.parse(localStorage.highscores));var t=this,e=document.getElementById("ablast-ui");document.getElementById("save-score").addEventListener("click",function(i){ABLAST.currentScore.name=document.getElementById("player-name").value,t.addNewScore(ABLAST.currentScore),e.style.display="none"}),this.sceneEl.addEventListener("gamestate-changed",function(i){"state"in i.detail.diff&&("STATE_GAME_OVER"!==i.detail.state.state&&"STATE_GAME_WIN"!==i.detail.state.state||(e.style.display=t.isHighScore(ABLAST.currentScore)?"block":"none"))})},isHighScore:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},shouldStoreScore:function(t){return this.scores.length<this.data.maxScores||this.scores[this.scores.length-1].points<t.points},addNewScore:function(t){return!!this.shouldStoreScore(t)&&(this.scores.push(t),this.scores.sort(function(t,e){return t.points<=e.points}),this.scores.length>this.data.maxScores&&this.scores.pop(),localStorage.highscores=JSON.stringify(this.scores),this.sceneEl.emit("highscores-updated",this.scores),!0)}}),AFRAME.registerComponent("highscores",{schema:{},init:function(){var t=this.el,e=this,s=this.el.sceneEl;s.addEventListener("highscores-updated",function(s){t.setAttribute("bmfont-text",{text:i(e.system.scores)})}),t.setAttribute("bmfont-text",{fntImage:"assets/fonts/mozillavr.png",fnt:"assets/fonts/mozillavr.fnt",scale:.0015,baseline:"top",lineHeight:90,text:i(this.system.scores),color:"#24caff"})}})},function(t,e){AFRAME.registerComponent("proxy_event",{schema:{event:{"default":""},dst:{type:"selector"},bubbles:{"default":!1}},init:function(){this.el.sceneEl.addEventListener(this.data.event,function(t){this.data.dst.emit(this.data.event,t,this.data.bubbles)}.bind(this))}})},function(t,e){AFRAME.registerComponent("countdown",{schema:{start:{"default":"01:00"},value:{"default":"00:00"},autostart:{"default":!1}},init:function(){this.timeinterval=null,this.data.autostart&&this.restart();var t=this;this.el.sceneEl.addEventListener("gamestate-changed",function(e){if("state"in e.detail.diff)switch(e.detail.state.state){case"STATE_PLAYING":t.restart();break;case"STATE_GAME_OVER":case"STATE_GAME_WIN":case"STATE_MAIN_MENU":t.stop()}})},initializeClock:function(t){function e(){var e=Date.parse(t)-Date.parse(new Date),s=Math.floor(e/1e3%60),n=Math.floor(e/1e3/60%60),o={total:e,minutes:n,seconds:s};i.el.sceneEl.emit("countdown-update",o),o.total<=0&&(clearInterval(i.timeinterval),i.el.sceneEl.emit("countdown-end"))}var i=this;this.el.sceneEl.emit("countdown-start",t),this.timeinterval=setInterval(e,1e3),e()},stop:function(){clearInterval(this.timeinterval),this.el.sceneEl.emit("countdown-update",{total:0,minutes:0,seconds:0})},restart:function(){this.stop();var t=this.data.start.split(":").map(function(t){return parseInt(t)}),e=new Date(Date.parse(new Date)+1e3*(60*t[0]+t[1]));this.initializeClock(e)}})},function(t,e){AFRAME.registerSystem("decals",{schema:{size:{"default":.1},src:{"default":"",type:"asset"},maxDecals:{"default":30}},init:function(){this.data;this.numDecals=0,this.decals=[],this.oldestDecalIdx=0,this.textureSrc=null,this.geometry=new THREE.PlaneGeometry(1,1),this.material=new THREE.MeshBasicMaterial({transparent:!0,color:"#24CAFF",depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-20}),this.updateMap()},updateMap:function(){function t(t){this.material.map=t,this.material.needsUpdate=!0}var e=this.data.src;if(e){if(e===this.textureSrc)return;return this.textureSrc=e,void this.sceneEl.systems.material.loadTexture(e,{src:e},t.bind(this))}this.material.map&&t(null)},update:function(t){this.updateMap()},getDecal:function(){var t=this.data.maxDecals,e=this.data.size,i=null;return 0===t||this.numDecals<t?(i=new THREE.Mesh(this.geometry,this.material),this.numDecals++,this.decals.push(i)):(i=this.decals[this.oldestDecalIdx],this.oldestDecalIdx=(this.oldestDecalIdx+1)%this.data.maxDecals),i.scale.set(e,e,e),i},addDecal:function(t,e){var i=this.getDecal();i&&(i.position.set(0,0,0),i.position.copy(t),i.lookAt(e),i.rotation.z+=Math.random()*Math.PI*2,this.sceneEl.object3D.add(i))}})},function(t,e){function i(t){return.5*(1-Math.cos(Math.PI*t))}function s(t){function e(t,e,i,s,n,o,a){var r=.5*(i-t),l=.5*(s-e);return(2*(e-i)+r+l)*a+(-3*(e-i)-2*r-l)*o+r*n+e}var i=new THREE.Spline(t);return i.getPointFrom=function(t,i){var s,n,o,a,r,l,h,c,d,u,m;return l=this.points,h=i+t,s=[],s[0]=0===i?i:i-1,s[1]=i,s[2]=i>l.length-2?l.length-1:i+1,s[3]=i>l.length-3?l.length-1:i+2,n=l[s[0]],o=l[s[1]],a=l[s[2]],r=l[s[3]],m=h-i,c=m*m,d=m*c,u={},u.x=e(n.x,o.x,a.x,r.x,m,c,d),u.y=e(n.y,o.y,a.y,r.y,m,c,d),u.z=e(n.z,o.z,a.z,r.z,m,c,d),u},i.getPointFrom=i.getPointFrom.bind(i),i}AFRAME.registerComponent("curve-movement",{schema:{debug:{"default":!1},type:{"default":"single"},restTime:{"default":150},speed:{"default":3},loopStart:{"default":1},timeOffset:{"default":0}},init:function(){this.direction=1},isClosed:function(){return"loop"===this.data.type},addPoints:function(t){var e,i,n=this.data;this.el;"loop"===n.type&&(t=t.slice(0),t.push(t[this.data.loopStart])),e=this.spline=s(),e.initFromArray(t),this.currentPointIndex=0,i=e.getLength().chunks,this.cycleTimes=i.map(function(t,e){return 0===e?null:(t-i[e-1])/n.speed*1e3}).filter(function(t){return null!==t}),this.time=this.data.timeOffset,this.initTime=null,this.restTime=0,this.direction=1,this.end=!1},update:function(){var t=this.data,e=this.el;t.debug?e.setAttribute("spline-line",{pointer:"movement-pattern.movementPattern.spline"}):e.removeAttribute("spline-line")},play:function(){this.time=this.data.timeOffset,this.initTime=null},tick:function(t,e){var s,n,o,a=this.data,r=this.el,l=(this.restTime,this.spline);if(this.initTime||(this.initTime=t),!this.end&&(this.isClosed()||this.currentPointIndex!==l.points.length-1)){s=this.cycleTimes[this.currentPointIndex];var h=0,c=!1;if("single"===a.type||"pingpong"===a.type,this.time>s?(h=1,c=!0):h=this.time/s,this.direction===-1&&(h=1-h),n="single"===a.type?i(h):h,this.time=t-this.initTime,this.time<0)return void console.log(n);o=l.getPointFrom(n,this.currentPointIndex),r.setAttribute("position",{x:o.x,y:o.y,z:o.z}),this.lastPercent=n,c&&(1===this.direction?this.currentPointIndex===l.points.length-2?"single"===a.type?this.end=!0:"loop"===a.type?this.currentPointIndex=this.data.loopStart:this.direction=-1:this.currentPointIndex++:(this.currentPointIndex--,this.currentPointIndex<this.data.loopStart&&(this.currentPointIndex=this.data.loopStart,this.direction=1)),this.initTime=t,this.time=0)}}})},function(t,e){AFRAME.registerComponent("collision-helper",{schema:{type:{"default":"sphere",oneOf:["sphere","box"]},radius:{"default":1,"if":{type:["sphere"]}},debug:{"default":!1},color:{type:"color","default":8947848}},init:function(){var t=(this.el,this.data);this.geometry=new THREE.IcosahedronGeometry(1,1),this.material=new THREE.MeshBasicMaterial({color:t.color,wireframe:!0}),this.helperMesh=null,t.debug&&this.createHelperMesh()},createHelperMesh:function(){var t=this.data.radius;this.helperMesh=new THREE.Mesh(this.geometry,this.material),this.helperMesh.visible=!0,this.helperMesh.scale.set(t,t,t),this.el.setObject3D("collision-helper-mesh",this.helperMesh)},update:function(t){var e=this.data;e.debug&&(this.helperMesh?(this.material.color.set(e.color),this.helperMesh.scale.set(e.radius,e.radius,e.radius),this.helperMesh.visible=e.debug):this.createHelperMesh())}})},function(t,e){ABLAST.currentScore={name:"",points:0,time:0,shoots:0,validShoot:0},AFRAME.registerComponent("gamestate",{schema:{health:{"default":5},numEnemies:{"default":0},numSequences:{"default":0},points:{"default":0},numEnemiesToWin:{"default":100},isGameOver:{"default":!1},isGameWin:{"default":!1},state:{"default":"STATE_MAIN_MENU",oneOf:["STATE_MAIN_MENU","STATE_PLAYING","STATE_GAME_OVER","STATE_GAME_WIN"]},wave:{"default":0},waveSequence:{"default":0}},gameEnd:function(t,e){t.state="STATE_GAME_WIN",t.isGameWin=!0,document.getElementById("introMusic").components.sound.playSound(),document.getElementById("mainThemeMusic").components.sound.pauseSound()},init:function(){function t(t,i){s.addEventListener(t,function(s){var n=i(AFRAME.utils.extend({},o),s);e(t,n)})}function e(t,e){var i=AFRAME.utils.extend({},o);s.setAttribute("gamestate",e),o=e,s.emit("gamestate-changed",{event:t,diff:AFRAME.utils.diff(i,e),state:e})}var i=this,s=this.el,n=this.initialState,o=this.data;n||(n=o),s.emit("gamestate-initialized",{state:n}),t("enemy-death",function(t){return t.points++,ABLAST.currentScore.points++,t.points>=i.data.numEnemiesToWin&&i.gameEnd(t,!0),t.numEnemies--,0===t.numEnemies&&(t.numSequences--,t.waveSequence++,0===t.numSequences&&(t.waveSequence=0,t.wave++,t.wave>=WAVES.length&&i.gameEnd(t,!0))),t}),t("wave-created",function(t,e){var i=e.detail.wave;return t.numSequences=i.sequences.length,t.waveSequence=0,t}),t("enemy-spawn",function(t){return t.numEnemies++,t}),t("start-game",function(t){return t.isGameOver=!1,t.isGameWin=!1,t.state="STATE_PLAYING",t}),t("player-hit",function(t){return"STATE_PLAYING"===t.state&&(t.health-=1,t.health<=0&&(t.isGameOver=!0,t.numEnemies=0,t.state="STATE_GAME_OVER",document.getElementById("introMusic").components.sound.playSound(),document.getElementById("mainThemeMusic").components.sound.pauseSound())),t}),t("reset",function(){return ABLAST.currentScore={name:"",points:0,time:0,shoots:0,validShoot:0},n})}}),AFRAME.registerComponent("gamestate-bind",{schema:{"default":{},parse:AFRAME.utils.styleParser.parse},update:function(){var t=this.el.closestScene();t.hasLoaded&&this.updateBinders(),t.addEventListener("loaded",this.updateBinders.bind(this))},updateBinders:function(){function t(t){Object.keys(t).forEach(function(n){var o=e[n],a=t[n];s.indexOf(n)!==-1&&AFRAME.utils.entity.setComponentProperty(i,o,a)})}var e=this.data,i=this.el,s=Object.keys(this.data);i.sceneEl.addEventListener("gamestate-changed",function(e){t(e.detail.diff)}),i.sceneEl.addEventListener("gamestate-initialized",function(e){t(e.detail.state)})}})},function(t,e){function i(t){var e="DEBUG\n";return Object.keys(t).sort().forEach(function(i){e+=i+": "+t[i]+"\n"}),e}AFRAME.registerComponent("gamestate-debug",{init:function(){function t(t){e.setAttribute("bmfont-text",{text:i(t.detail.state),color:"#DADADA"})}var e=this.el,s=this.el.sceneEl;s.addEventListener("gamestate-initialized",t),s.addEventListener("gamestate-changed",t)}})},function(t,e){AFRAME.registerComponent("shoot-controls",{dependencies:["tracked-controls"],schema:{hand:{"default":"left"}},init:function(){var t=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){t.onButtonEvent(e.detail.id,"down")},this.onButtonUp=function(e){t.onButtonEvent(e.detail.id,"up")},this.onModelLoaded=this.onModelLoaded.bind(this)},play:function(){var t=this.el;t.addEventListener("buttonchanged",this.onButtonChanged),t.addEventListener("buttondown",this.onButtonDown),t.addEventListener("buttonup",this.onButtonUp),t.addEventListener("model-loaded",this.onModelLoaded)},pause:function(){var t=this.el;t.removeEventListener("buttonchanged",this.onButtonChanged),t.removeEventListener("buttondown",this.onButtonDown),t.removeEventListener("buttonup",this.onButtonUp),t.removeEventListener("model-loaded",this.onModelLoaded)},mapping:{axis0:"trackpad",axis1:"trackpad",button0:"trackpad",button1:"trigger",button2:"grip",button3:"menu",button4:"system"
},onButtonChanged:function(t){var e=this.mapping["button"+t.detail.id];if("trigger"===e){var i=t.detail.state.value;this.el.components.weapon.setTriggerPressure(i)}},onModelLoaded:function(t){},onButtonEvent:function(t,e){var i=this.mapping["button"+t];this.el.emit(i+e)},update:function(){var t=this.data,e=this.el,i="right"===t.hand?0:1;e.setAttribute("tracked-controls","controller",i)}})},function(t,e){AFRAME.registerComponent("bullet",{schema:{name:{"default":""},direction:{type:"vec3"},maxSpeed:{"default":5},initialSpeed:{"default":5},position:{type:"vec3"},acceleration:{"default":.5},destroyable:{"default":!1},owner:{"default":"player",oneOf:["enemy","player"]},color:{"default":"#fff"}},init:function(){this.startEnemy=document.getElementById("start_enemy"),this.backgroundEl=document.getElementById("border"),this.bullet=ABLAST.BULLETS[this.data.name],this.bullet.definition.init.call(this),this.hit=!1,this.direction=new THREE.Vector3},update:function(t){var e=this.data;this.owner=this.data.owner,this.direction.set(e.direction.x,e.direction.y,e.direction.z),this.currentAcceleration=e.acceleration,this.speed=e.initialSpeed,this.startPosition=e.position},play:function(){this.initTime=null},hitObject:function(t,e){if(this.bullet.definition.onHit.call(this),this.hit=!0,"enemy"===this.data.owner)this.el.emit("player-hit"),document.getElementById("hurtSound").components.sound.playSound();else if("bullet"===t)e.components.bullet.resetBullet(),this.el.sceneEl.systems.explosion.createExplosion(t,e.object3D.position,e.getAttribute("bullet").color,1,this.direction),ABLAST.currentScore.validShoot++;else if("background"===t){this.el.sceneEl.systems.decals.addDecal(e.point,e.face.normal);var i=e.point.clone().sub(this.direction.clone().multiplyScalar(.2));this.el.sceneEl.systems.explosion.createExplosion(t,i,"#fff",1,this.direction)}else if("enemy"===t){var s=e.getAttribute("enemy");e.components.enemy.health<=0?this.el.sceneEl.systems.explosion.createExplosion("enemy",e.object3D.position,s.color,s.scale,this.direction,s.name):this.el.sceneEl.systems.explosion.createExplosion("bullet",this.el.object3D.position,s.color,s.scale,this.direction),ABLAST.currentScore.validShoot++}this.resetBullet()},resetBullet:function(){this.hit=!1,this.bullet.definition.reset.call(this),this.initTime=null,this.direction.set(this.data.direction.x,this.data.direction.y,this.data.direction.z),this.currentAcceleration=this.data.acceleration,this.speed=this.data.initialSpeed,this.startPosition=this.data.position,this.system.returnBullet(this.data.name,this.el)},tick:function(){var t=new THREE.Vector3,e=new THREE.Vector3;return function(i,s){this.initTime||(this.initTime=i),this.bullet.definition.tick.call(this,i,s),this.el.object3D.lookAt(this.direction.clone().multiplyScalar(1e3)),t.copy(this.el.getAttribute("position")),this.speed=.1*this.currentAcceleration*s,this.speed>this.data.maxSpeed&&(this.speed=this.data.maxSpeed),e.copy(this.direction);var n=t.add(e.multiplyScalar(this.speed));if(this.el.setAttribute("position",n),t.length()>=50)return void this.resetBullet();var o=this.el.getAttribute("collision-helper");if(o){var a=o.radius;if("player"===this.data.owner){if("player"===this.data.owner){var r=this.el.sceneEl.getAttribute("gamestate").state;if("STATE_MAIN_MENU"===r){var l=this.startEnemy,h=l.getAttribute("collision-helper"),c=h.radius;if(n.distanceTo(l.object3D.position)<c+a)return this.el.sceneEl.systems.explosion.createExplosion("enemy",this.el.getAttribute("position"),"#ffb911",.5,this.direction,"enemy_start"),l.emit("hit"),document.getElementById("introMusic").components.sound.pauseSound(),void document.getElementById("mainThemeMusic").components.sound.playSound()}else if("STATE_GAME_WIN"===r||"STATE_GAME_OVER"===r){var l=document.getElementById("reset"),h=l.getAttribute("collision-helper"),c=h.radius;if(n.distanceTo(l.object3D.position)<2*c+2*a)return this.el.sceneEl.systems.explosion.createExplosion("enemy",this.el.getAttribute("position"),"#f00",.5,this.direction,"enemy_start"),void this.el.sceneEl.emit("reset")}else for(var d=this.el.sceneEl.systems.enemy.activeEnemies,u=0;u<d.length;u++){var l=d[u],h=l.getAttribute("collision-helper");if(h){var c=h.radius;if(n.distanceTo(l.object3D.position)<c+a)return l.emit("hit"),void this.hitObject("enemy",l)}}for(var m=this.system.activeBullets,u=0;u<m.length;u++){var p=m[u],f=p.components.bullet.data;if("player"!==f.owner&&f.destroyable){var g=p.components["collision-helper"];if(g){var E=g.data.radius;if(n.distanceTo(p.getAttribute("position"))<E+a)return void this.hitObject("bullet",p)}}}}}else{var y=this.el.sceneEl.camera.el.components["look-controls"].dolly.position;if(n.distanceTo(y)<.1+a)return void this.hitObject("player")}var v=new THREE.Raycaster(t,e.clone().normalize()),b=this.backgroundEl.getObject3D("mesh");if(b){var A=v.intersectObjects(b.children,!0),S=this;A.forEach(function(e){if(e.distance<t.length()){if(!e.object.el)return;return void S.hitObject("background",e)}})}}}}()})},function(t,e,i){var s=i(31);AFRAME.registerComponent("lifes-counter",{schema:{width:{"default":.9},value:{"default":"      "},numSegments:{"default":6},height:{"default":.2},color:{"default":16711680}},init:function(){this.letterPanel=new s(this.el.sceneEl.systems.material,this.data),this.el.setObject3D("mesh",this.letterPanel.group)},update:function(){var t=this.data.value,e=[0,0,0,0,0].map(function(e,i){return i>=t?" ":"*"}).reverse().join("");this.letterPanel.update(e)}})},function(t,e){function i(t,e){function i(t){this.material.map=t,this.material.needsUpdate=!0}this.width=e.width,this.height=e.height,this.numSegments=e.numSegments;var n="assets/images/font.png";t.loadTexture(n,{src:n},i.bind(this)),this.material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,color:e.color,transparent:!0}),this.group=new THREE.Group;var o=this.width/this.numSegments;this.numLetters=s.length;for(var a=0;a<this.numSegments;a++)plane=new THREE.Mesh(new THREE.PlaneBufferGeometry(o,this.height),this.material),plane.position.x=a*o,this.group.add(plane)}var s="0123456789:* ";i.prototype={update:function(t){t=t.split("").map(function(t){return s.indexOf(t)});for(var e=1/this.numLetters,i=0;i<this.numSegments;i++){var n=this.group.children[i].geometry.attributes.uv,o=n.array,a=t[i]*e,r=(t[i]+1)*e;o[0]=a,o[4]=a,o[2]=r,o[6]=r,n.needsUpdate=!0}}},t.exports=i},function(t,e,i){var s=i(31);AFRAME.registerComponent("points-counter",{schema:{value:{"default":0},height:{"default":.7},numSegments:{"default":3},width:{"default":.9},color:{"default":2411263}},init:function(){this.letterPanel=new s(this.el.sceneEl.systems.material,this.data),this.el.setObject3D("mesh",this.letterPanel.group),this.el.sceneEl.addEventListener("enemy-death",function(){})},update:function(){this.letterPanel.update(this.data.value.padLeft(3))}})},function(t,e,i){var s=i(31);AFRAME.registerComponent("timer-counter",{schema:{width:{"default":.9},value:{"default":""},numSegments:{"default":5},height:{"default":.35},color:{"default":2411263}},init:function(){this.letterPanel=new s(this.el.sceneEl.systems.material,this.data),this.el.setObject3D("mesh",this.letterPanel.group);var t=this;this.el.sceneEl.addEventListener("countdown-update",function(e){var i=e.detail,s=i.minutes.padLeft(2)+":"+i.seconds.padLeft(2);t.letterPanel.material.color.set(i.total<=1e4?16711680:2411263),t.el.setAttribute("timer-counter",{value:s})})},update:function(){this.letterPanel.update(this.data.value)}})},function(t,e){AFRAME.registerComponent("enemy",{schema:{name:{"default":"enemy0"},bulletName:{"default":"enemy-slow"},shootingDelay:{"default":200},health:{"default":1},color:{"default":"#fff"},scale:{"default":1},canShoot:{"default":!0}},init:function(){function t(t){this.gunGlowMaterial.alphaMap=t,this.gunGlowMaterial.needsUpdate=!0,this.gunGlowMaterial.visible=!0}this.alive=!0,this.hipBone=null,this.definition=ABLAST.ENEMIES[this.data.name].definition,this.definition.init.call(this);var e=ABLAST.ENEMIES[this.data.name].components.enemy;this.maxhealth=this.health=e.health,this.color=e.color,this.scale=e.scale,this.gunOffset=new THREE.Vector3(0,.44,.5).multiplyScalar(this.scale),this.lastShootTime=void 0,this.shootAt=0,this.warmUpTime=1e3,this.paused=!1;var i=this;this.el.addEventListener("model-loaded",function(t){i.el.components["json-model"].playAnimation("fly",!0),i.hipBone=i.el.object3D.children[3].children[0]}),this.gunGlowMaterial=new THREE.MeshBasicMaterial({color:this.color,side:THREE.DoubleSide,transparent:!0,blending:THREE.AdditiveBlending,depthTest:!0,depthWrite:!1,visible:!1});var s=document.querySelector("#fx3").getAttribute("src");this.el.sceneEl.systems.material.loadTexture(s,{src:s},t.bind(this)),this.gunGlow=new THREE.Mesh(new THREE.PlaneGeometry(this.scale,this.scale),this.gunGlowMaterial),this.gunGlow.position.copy(this.gunOffset),this.el.setObject3D("glow",this.gunGlow),this.exploding=!1,this.explodingDuration=500+Math.floor(300*Math.random()),this.el.addEventListener("hit",this.collided.bind(this)),this.sounds=[document.getElementById("explosion0"),document.getElementById("explosion1"),document.getElementById("explosion2")]},update:function(t){},play:function(){this.paused=!1},pause:function(){this.paused=!0},collided:function(){if(!this.exploding&&(this.health--,this.health<=0)){this.el.emit("enemy-hit"),this.exploding=!0;var t=this.el.getObject3D("mesh");this.whiteMaterial=new THREE.MeshBasicMaterial({color:this.color,transparent:!0}),t.normalMaterial=t.material,t.material=this.whiteMaterial,this.gunGlow.visible=!1,this.system.activeEnemies.splice(this.system.activeEnemies.indexOf(this.el),1)}},die:function(){this.alive=!1,this.reset(),this.system.onEnemyDeath(this.data.name,this.el)},reset:function(){var t=this.el.getObject3D("mesh");t&&(t.material.opacity=1,t.scale.set(this.scale,this.scale,this.scale),t.material=t.normalMaterial,this.gunGlow.visible=!0,this.gunGlow.scale.set(1,1,1),this.gunGlowMaterial.opacity=.3),this.el.setAttribute("scale","1 1 1"),this.explodingTime=void 0,this.lastShootTime=void 0,this.shootAt=0,this.warmUpTime=1e3,this.health=this.maxhealth,this.alive=!0,this.exploding=!1,this.definition.reset.call(this)},shoot:function(t,e){var i=this.el;if(i){var s=this.data,n=i.object3D,o=n.localToWorld(this.gunGlow.position.clone()),a=i.sceneEl.camera.el.components["look-controls"].dolly.position.clone(),r=a.sub(n.position).normalize();this.lastShootTime=t,this.gunGlow.scale.set(3,3,3),this.gunGlowMaterial.opacity=1,this.el.sceneEl.systems.explosion.createExplosion("enemygun",o,this.color,this.scale,r,this.data.name);var l=i.sceneEl.systems.bullet.getBullet(s.bulletName);l.setAttribute("bullet",{position:o,direction:r,owner:"enemy"}),l.setAttribute("position",o),l.setAttribute("visible",!0),l.play()}},willShoot:function(t,e,i){this.shootAt=t+i,this.warmUpTime=i},tick:function(t,e){if(this.alive&&!this.paused)if(this.exploding){this.explodingTime||(this.explodingTime=t);var i=(t-this.explodingTime)/this.explodingDuration,s=this.scale+i*(2-i),n=this.el.getObject3D("mesh");n.scale.set(s,s,s),n.material.opacity=Math.max(0,1-2.5*i),i>=1&&this.die()}else{var o=700;if(void 0===this.lastShootTime)this.lastShootTime=t;else if(this.shootAt-t<this.warmUpTime){this.gunGlowMaterial.opacity=(this.shootAt-t)/this.warmUpTime;var a=1+Math.abs(Math.sin(t/50));this.gunGlow.scale.set(a,a,a)}else t-this.lastShootTime<o&&(this.gunGlowMaterial.opacity=1-(t-this.lastShootTime)/o);this.gunGlow.position.copy(this.gunOffset),this.hipBone&&(this.gunGlow.position.y+=this.hipBone.position.y);var r=this.el.sceneEl.camera.el.components["look-controls"].dolly.position.clone();this.el.object3D.lookAt(r),this.definition.tick.call(this,t,e)}}})},function(t,e){var i={"default":{model:{url:"url(assets/models/gun.json)",positionOffset:[0,0,0],rotationOffset:[0,0,0]},shootSound:"url(assets/sounds/gun.ogg)",shootingDelay:100,bullet:"default"}};AFRAME.registerComponent("weapon",{dependencies:["shoot-controls"],schema:{enabled:{"default":!0},type:{"default":"default"}},init:function(){var t=this.el;this.model=null,this.weapon=i[this.data.type],t.setAttribute("json-model",{src:this.weapon.model.url}),t.setAttribute("sound",{src:this.weapon.shootSound,on:"shoot",volume:.5,poolSize:10}),this.fires=[],this.trigger=null,t.addEventListener("model-loaded",function(e){this.model=e.detail.model;var i=new THREE.Group;i.add(this.model),t.setObject3D("mesh",i);for(var s=0;s<3;s++){var n=this.model.getObjectByName("fire"+s);n&&(n.material.depthWrite=!1,n.visible=!1,this.fires.push(n))}this.trigger=this.model.getObjectByName("trigger")}.bind(this));var e=this;t.addEventListener("shoot",function(i){t.components["json-model"].playAnimation("default"),e.light.components.light.light.intensity=e.lightIntensity;for(var s in e.fires)e.fires[s].visible=!0,e.fires[s].life=50+100*Math.random()}),this.lightIntensity=3,this.life=this.data.lifespan,this.canShoot=!0,this.light=document.createElement("a-entity"),t.appendChild(this.light),this.light.setAttribute("light",{color:"#24CAFF",intensity:0,type:"point"}),this.light.setAttribute("position",{x:0,y:-.22,z:-.14}),this.lightObj=this.light.components.light.light},tick:function(t,e){if(this.lightObj&&this.lightObj.intensity>0){this.light.visible=!0,this.lightObj.intensity-=e/1e3*10,this.lightObj.intensity<0&&(this.lightObj.intensity=0,this.light.visible=!1);for(var i in this.fires)this.fires[i].visible&&(this.fires[i].life-=e,0==i?this.fires[i].rotation.set(0,Math.random()*Math.PI*2,0):this.fires[i].rotation.set(0,1*Math.random()-.5+(Math.random()>.5?Math.PI:0),0),this.fires[i].life<0&&(this.fires[i].visible=!1))}},update:function(){var t=this.data;this.weapon=i[t.type]},setTriggerPressure:function(t){this.trigger&&this.trigger.position.setY(.01814*t)}}),AFRAME.registerComponent("shoot",{schema:{direction:{type:"vec3","default":{x:0,y:-2,z:-1}},on:{"default":"triggerdown"},spaceKeyEnabled:{"default":!1},weapon:{"default":"default"}},init:function(){var t=this.data,e=this.el,i=this;this.coolingDown=!1,this.shoot=this.shoot.bind(this),this.weapon=null,t.on&&e.addEventListener(t.on,this.shoot),t.spaceKeyEnabled&&window.addEventListener("keydown",function(t){"Space"!==t.code&&"32"!==t.keyCode||i.shoot()})},update:function(t){this.weapon=i[this.data.weapon]},shoot:function(){var t=new THREE.Vector3,e=new THREE.Vector3,i=new THREE.Quaternion,s=new THREE.Vector3,n=new THREE.Vector3;return function(){var o,a,r,l=this.el,h=this.data,c=this,d=this.weapon;this.coolingDown||(ABLAST.currentScore.shoots++,r=l.object3D.matrixWorld,e.setFromMatrixPosition(r),r.decompose(n,i,s),t.set(h.direction.x,h.direction.y,h.direction.z),t.applyQuaternion(i),t.normalize(),a=new THREE.Vector3(0,(-.23),(-.15)),a.applyQuaternion(i),e.add(a),o=l.sceneEl.systems.bullet.getBullet(d.bullet),o.setAttribute("position",e),o.setAttribute("bullet",{direction:t,position:e,owner:"player"}),o.setAttribute("visible",!0),o.setAttribute("position",e),o.play(),l.emit("shoot",o),this.coolingDown=!0,setTimeout(function(){c.coolingDown=!1},d.shootingDelay))}}()})},function(t,e){AFRAME.registerComponent("headset",{schema:{on:{"default":"click"}},init:function(){},tick:function(t,e){var i=this.el.getObject3D("mesh");i&&i.update(e/1e3),this.updatePose(),this.updateButtons()},updatePose:function(){var t=new THREE.Euler,e=new THREE.Vector3,i=new THREE.Quaternion,s=new THREE.Object3D,n=new THREE.Matrix4;return t.order="YXZ",function(){var o,a,r,l,h=this.el,c=this.system.vrDisplay;this.update(),o=this.controller,o&&(a=o.pose,r=a.orientation||[0,0,0,1],l=a.position||[0,0,0],i.fromArray(r),s.quaternion.fromArray(r),s.position.fromArray(l),s.updateMatrix(),c&&c.stageParameters&&(n.fromArray(c.stageParameters.sittingToStandingTransform),s.applyMatrix(n)),t.setFromRotationMatrix(s.matrix),e.setFromMatrixPosition(s.matrix),h.setAttribute("rotation",{x:THREE.Math.radToDeg(t.x),y:THREE.Math.radToDeg(t.y),z:THREE.Math.radToDeg(t.z)}),h.setAttribute("position",{x:e.x,y:e.y,z:e.z}))}}()})},function(t,e){AFRAME.registerComponent("json-model",{schema:{src:{type:"asset"},singleModel:{"default":!1},texturePath:{type:"asset","default":""},debugNormals:{"default":!1},debugNormalsLength:{"default":.2},debugBones:{"default":!1}},init:function(){},fixNormal:function(t){var e=t.y;t.y=-t.z,t.z=e},update:function(t){this.loader=null,this.helpers=new THREE.Group,this.mixers=[],this.animationNames=[],this.skeletonHelper=null;var e=this.data.src;e&&e!==t.src&&(this.data.singleModel?(this.loader=new THREE.JSONLoader,this.loader.setTexturePath(this.data.texturePath),this.loader.load(e,this.onModelLoaded.bind(this))):(this.loader=new THREE.ObjectLoader,this.loader.setCrossOrigin(""),this.loader.load(e,this.onSceneLoaded.bind(this))))},onModelLoaded:function(t,e){this.helpers=new THREE.Group;var i=new THREE.SkinnedMesh(t,e[0]),s=this;if(i.geometry.faces.forEach(function(t){t.vertexNormals.forEach(function(t){t.hasOwnProperty("fixed")||(s.fixNormal(t),t.fixed=!0)})}),void 0!==i.geometry.animations&&i.geometry.animations.length>0){i.material.skinning=!0;var n={mixer:new THREE.AnimationMixer(i),clips:{}};for(var o in i.geometry.animations){var a=i.geometry.animations[o],r=n.mixer.clipAction(a).stop();r.setEffectiveWeight(1),n.clips[a.name]=r}this.mixers.push(n)}s.addNormalHelpers(i),this.helpers.visible=this.data.debugNormals,this.el.setObject3D("helpers",this.helpers),this.skeletonHelper=new THREE.SkeletonHelper(i),this.skeletonHelper.material.linewidth=2,this.el.setObject3D("skelhelper",this.skeletonHelper),this.skeletonHelper.visible=this.data.debugBones,this.el.setObject3D("mesh",i),this.el.emit("model-loaded",{format:"json",model:i,src:this.data.src})},onSceneLoaded:function(t){if(this.helpers=new THREE.Group,void 0!==t.animations){var e={mixer:new THREE.AnimationMixer(t),clips:{}};for(var i in t.animations){var s=t.animations[i],n=e.mixer.clipAction(s).stop();e.clips[s.name]=n}this.mixers.push(e)}var o=this;t.traverse(function(t){t instanceof THREE.Mesh&&(t.geometry.faces.forEach(function(t){t.vertexNormals.forEach(function(t){t.hasOwnProperty("fixed")||(o.fixNormal(t),t.fixed=!0)})}),o.addNormalHelpers(t))}),this.helpers.visible=this.data.debugNormals,this.el.setObject3D("helpers",this.helpers),this.el.setObject3D("mesh",t),this.el.emit("model-loaded",{format:"json",model:t,src:this.data.src})},addNormalHelpers:function(t){var e=new THREE.FaceNormalsHelper(t,this.data.debugNormalsLength);this.helpers.add(e);var i=new THREE.VertexNormalsHelper(t,this.data.debugNormalsLength);this.helpers.add(i),t.geometry.normalsNeedUpdate=!0,t.geometry.verticesNeedUpdate=!0},playAnimation:function(t,e){for(var i in this.mixers){var s=this.mixers[i].clips[t];if(void 0!==s){s.stop().play();var n=0;e===!0?n=1/0:void 0==e?e=!1:"number"==typeof e?(0===e&&(e=!1),n=e):e=!1,s.setLoop(e?THREE.LoopRepeat:THREE.LoopOnce,n)}}},stopAnimation:function(){for(var t in this.mixers)for(var e in this.mixers[t].clips)this.mixers[t].clips[e].stop()},tick:function(t,e){for(var i in this.mixers)this.mixers[i].mixer.update(e/1e3);this.skeletonHelper&&this.skeletonHelper.update()}})},function(t,e){var i=ABLAST.MOVEMENT_PATTERNS=t.exports.MOVEMENT_PATTERNS={};AFRAME.registerMovementPattern=function(t,e){var s,n,o={};if(Object.keys(e).forEach(function(t){o[t]={value:e[t],writable:!0}}),i[t])throw new Error("The movement pattern`"+t+"` has been already registered. Check that you are not loading two versions of the same movement pattern or two different movement patterns of the same name.");s=function(t,e){this.el=t,this.data=e},s.prototype={schema:{},init:function(){},update:function(){},tick:function(t,e){}},n=function(t,e){s.call(this,t,e)},n.prototype=Object.create(s.prototype,o),i[t]={MovementPattern:n,schema:n.prototype.schema}},AFRAME.registerComponent("movement-pattern",{schema:{type:{"default":"random"}},updateSchema:function(t){var e=this.data&&this.data.type,s=t.type,n=s||e,o=i[n]&&i[n].schema;if(!o)throw new Error("Unknown movement pattern "+s);e&&s===e||this.extendSchema(o)},update:function(t){var e=this.data,s=this.el;t&&t.type!==e.type&&(this.movementPattern&&s.sceneEl.removeBehavior(this.movementPattern.tick),this.movementPattern=new i[e.type].MovementPattern(s,e),this.movementPattern.init()),this.movementPattern.data=e,this.movementPattern.update()},tick:function(t,e){this.movementPattern.tick&&this.movementPattern.tick(t,e)}})},function(t,e){AFRAME.registerComponent("spline-line",{schema:{pointer:{"default":""},numPoints:{"default":250}},init:function(){function t(){for(var t=s.pointer.split("."),e=t.shift(),i=n.components[e];t.length;){if(!i)return;i=i[t.shift()]}return i}var e,i,s=this.data,n=this.el,o=this;this.pointMeshes=[],i=t(),i?this.drawLine(i):(e=s.pointer.split(".")[0],n.addEventListener("componentchanged",function(i){i.detail.name===e&&o.drawLine(t())}))},drawLine:function(t){var e,i,s,n=this.data,o=this.el,a=this.pointMeshes;for(e=new THREE.Geometry,s=new THREE.LineBasicMaterial({color:new THREE.Color(Math.random(),Math.random(),Math.random())}),i=0;i<n.numPoints;i++){var r=t.getPoint(i/n.numPoints);e.vertices.push(new THREE.Vector3(r.x,r.y,r.z))}e.verticesNeedsUpdate=!0,t.points.forEach(function(t){var e=new THREE.SphereGeometry(.2,16,16),i=new THREE.MeshBasicMaterial({color:"#111"}),s=new THREE.Mesh(e,i);s.position.set(t.x,t.y,t.z),a.push(s),o.sceneEl.object3D.add(s)}),this.line=new THREE.Line(e,s),o.sceneEl.object3D.add(this.line)},remove:function(){var t=this.el.sceneEl.object3D;this.line&&(t.remove(this.line),this.pointMeshes.forEach(function(e){t.remove(e)}))}})},function(t,e){AFRAME.registerComponent("wave-text",{init:function(){var t=this.el,e=this;t.sceneEl.addEventListener("gamestate-changed",function(t){"wave-created"===t.detail.event&&setTimeout(function(){e.setText(t.detail.state)},500)})},setText:function(t){var e=this.el;e.setAttribute("bmfont-text",{color:"#FFF",opacity:0,text:"WAVE "+(t.wave+1)}),e.emit("wavetextchange")}})},function(t,e){AFRAME.registerComponent("explosion",{schema:{type:{"default":"enemy",oneOf:["enemy","bullet","background","enemygun"]},duration:{"default":500},color:{type:"color","default":"#FFFFFF"},lookAt:{type:"vec3","default":null},scale:{"default":1}},update:function(t){"enemy"===this.data.type?(this.materials[2].color.set(this.data.color),this.materials[4].color.set(this.data.color)):"bullet"===this.data.type?(this.data.scale*=.5,this.materials[0].color.set(this.data.color),this.materials[2].color.set(this.data.color)):"enemygun"===this.data.type?(this.materials[0].color.set(this.data.color),this.data.duration=300):"background"===this.data.type&&(this.data.duration=300);for(var e=0;e<this.meshes.children.length;e++){var i=this.meshes.children[e];this.data.lookAt&&i.lookAt(this.data.lookAt)}this.el.setAttribute("scale",{x:this.data.scale,y:this.data.scale,z:this.data.scale})},init:function(){function t(t,e){this.materials[t].alphaMap=e,this.materials[t].needsUpdate=!0,this.materials[t].visible=!0}this.life=0,this.starttime=null,this.meshes=new THREE.Group,this.materials=[];var e=new Array("#fx1","#fx2","#fx3","#fx4","#fx8");switch(this.el.setAttribute("scale",{x:this.data.scale,y:this.data.scale,z:this.data.scale}),this.data.type){case"enemy":this.parts=[{textureIdx:2,billboard:!0,color:16777215,scale:1.5,grow:4,dispersion:0,copies:1,speed:0},{textureIdx:0,billboard:!0,color:16777215,scale:.4,grow:2,dispersion:2.5,copies:3,speed:1},{textureIdx:3,billboard:!1,color:this.data.color,scale:1,grow:6,dispersion:0,copies:1,speed:0},{textureIdx:1,billboard:!0,color:16577633,scale:.04,grow:2,dispersion:3,copies:20,speed:2},{textureIdx:3,billboard:!0,color:this.data.color,scale:.2,grow:2,dispersion:2,copies:10,speed:1}];break;case"bullet":this.parts=[{textureIdx:2,billboard:!0,color:this.data.color,scale:.5,grow:3,dispersion:0,copies:1,speed:0},{textureIdx:4,billboard:!0,color:"#24CAFF",scale:.3,grow:4,dispersion:0,copies:1,speed:0},{textureIdx:0,billboard:!0,color:this.data.color,scale:.04,grow:2,dispersion:1.5,copies:8,speed:1}];break;case"background":this.parts=[{textureIdx:4,billboard:!0,color:"#24CAFF",scale:.3,grow:3,dispersion:0,copies:1,speed:0},{textureIdx:0,billboard:!0,color:"#24CAFF",scale:.03,grow:1,dispersion:.3,copies:8,speed:1.6,noFade:!0}];break;case"enemygun":this.parts=[{textureIdx:3,billboard:!0,color:this.data.color,scale:.5,grow:3,dispersion:0,copies:1,speed:0}]}for(var i in this.parts){var s=this.parts[i];s.meshes=[];var n=new THREE.PlaneGeometry(s.scale,s.scale),o=new THREE.MeshBasicMaterial({color:s.color,side:THREE.DoubleSide,transparent:!0,blending:THREE.AdditiveBlending,depthTest:!0,depthWrite:!1,visible:!1});o.noFade=s.noFade===!0,this.materials.push(o);var a=document.querySelector(e[s.textureIdx]).getAttribute("src");this.el.sceneEl.systems.material.loadTexture(a,{src:a},t.bind(this,i));for(var r=s.dispersion/2,l=0;l<s.copies;l++){var h=new THREE.Mesh(n,o);s.billboard?this.data.lookAt&&h.lookAt(this.data.lookAt):h.rotation.set(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),s.dispersion>0&&(h.position.set(Math.random()*s.dispersion-r,Math.random()*s.dispersion-r,Math.random()*s.dispersion-r),h.speed=s.speed+Math.random()/s.dispersion),h.part=s,this.meshes.add(h),s.meshes.push(h)}}this.el.setObject3D("explosion",this.meshes)},reset:function(){this.life=0,this.starttime=null;for(var t in this.parts)for(var e=this.parts[t],i=e.dispersion/2,s=0;s<e.copies;s++){var n=e.meshes[s];e.billboard?this.data.lookAt&&n.lookAt(this.data.lookAt):n.rotation.set(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),e.dispersion>0&&(n.position.set(Math.random()*e.dispersion-i,Math.random()*e.dispersion-i,Math.random()*e.dispersion-i),n.speed=e.speed+Math.random()/e.dispersion)}this.starttime=null,this.system.returnToPool(this.data.type,this.el)},tick:function(t,e){if(null===this.starttime&&(this.starttime=t),this.life=(t-this.starttime)/this.data.duration,this.life>1)return void this.reset();for(var i=this.life*(2-this.life),s=0;s<this.meshes.children.length;s++){var n=this.meshes.children[s],o=1+i*n.part.grow;n.scale.set(o,o,o),n.part.speed>0&&n.position.multiplyScalar(1+e/1e3*n.speed)}for(var s in this.materials)this.materials[s].noFade||(this.materials[s].opacity=1-i)}})},function(t,e){AFRAME.registerComponent("animate-message",{init:function(){var t=this;this.startMsg=null,this.el.addEventListener("model-loaded",function(e){t.startMsg=t.el.getObject3D("mesh").getObjectByName("start")})},tick:function(t,e){this.startMsg&&(this.startMsg.rotation.z=-Math.PI+Math.abs(.03*Math.sin(t/200)))}})},function(t,e){AFRAME.registerComponent("gamestate-visuals",{schema:{},init:function(){this.logo=document.getElementById("logo"),this.startEnemy=document.getElementById("start_enemy"),this.mainMenuGroup=document.getElementById("mainmenu"),this.messageGroup=document.getElementById("message-group"),this.gameover=document.getElementById("gameover-model"),this.welldone=document.getElementById("welldone-model"),this.reset=document.getElementById("reset"),this.highscores=document.getElementById("highscores");var t=this;this.el.sceneEl.addEventListener("gamestate-changed",function(e){"state"in e.detail.diff&&("STATE_PLAYING"===e.detail.state.state?t.startPlaying():"STATE_GAME_OVER"===e.detail.state.state?t.finishPlaying("GAME_OVER"):"STATE_GAME_WIN"===e.detail.state.state?t.finishPlaying("GAME_WIN"):"STATE_MAIN_MENU"===e.detail.state.state&&t.mainMenu())}.bind(this))},startPlaying:function(){this.highscores.setAttribute("visible",!1);var t=this,e={x:0};new AFRAME.TWEEN.Tween(e).to({x:.6*Math.PI},1e3).onComplete(function(){t.mainMenuGroup.setAttribute("visible",!1)}).easing(AFRAME.TWEEN.Easing.Back.InOut).onUpdate(function(){t.logo.object3D.rotation.x=e.x}).start();this.startEnemy.setAttribute("visible",!1)},finishPlaying:function(t){var e=this,i="GAME_OVER"===t,s=document.getElementById("finished");this.highscores.setAttribute("visible",!0),this.gameover.setAttribute("visible",i),this.welldone.setAttribute("visible",!i),s.setAttribute("visible",!0),s.object3D.position.y=-5;var n={y:-5};new AFRAME.TWEEN.Tween(n).to({y:1},1e3).easing(AFRAME.TWEEN.Easing.Elastic.Out).onUpdate(function(){s.object3D.position.y=n.y}).start();this.reset.object3D.position.y=-5;var o={y:-5};new AFRAME.TWEEN.Tween(o).to({y:0},1e3).delay(3e3).easing(AFRAME.TWEEN.Easing.Elastic.Out).onUpdate(function(){e.reset.object3D.position.y=o.y}).start()},mainMenu:function(){var t=this;this.startEnemy.setAttribute("position","0 -5 -4"),this.startEnemy.setAttribute("visible",!0),this.mainMenuGroup.setAttribute("visible",!0);var e={positionY:-5},i=(new AFRAME.TWEEN.Tween(e).to({positionY:1.4},1e3).delay(1e3).easing(AFRAME.TWEEN.Easing.Back.InOut).onUpdate(function(){t.startEnemy.setAttribute("position",{x:0,y:e.positionY,z:-4})}).start(),document.getElementById("finished"));i.object3D.position.y=1;var s={y:1};new AFRAME.TWEEN.Tween(s).to({y:-5},1e3).easing(AFRAME.TWEEN.Easing.Elastic.In).onComplete(function(){i.setAttribute("visible",!1)}).onUpdate(function(){i.object3D.position.y=s.y}).start();this.logo.object3D.rotation.x=.6*Math.PI;var n={x:0};new AFRAME.TWEEN.Tween(n).to({x:.6*Math.PI},1e3).easing(AFRAME.TWEEN.Easing.Elastic.Out).delay(1e3).onUpdate(function(){t.logo.object3D.rotation.x=.6*Math.PI-n.x}).start()}})},function(t,e){AFRAME.registerComponent("sound-fade",{schema:{from:{"default":0},to:{"default":1},duration:{"default":1e3}},init:function(){this.el.getAttribute("sound")?(this.el.setAttribute("sound","volume",this.data.from),this.fadeEnded=!1,this.diff=this.data.to-this.data.from):this.fadeEnded=!0},update:function(t){this.endTime=void 0,this.fadeEnded=!1,this.diff=this.data.to-this.data.from},tick:function(t,e){if(!this.fadeEnded){if(void 0===this.endTime)return void(this.endTime=t+this.data.duration);var i=1-(this.endTime-t)/this.data.duration;i=Math.max(0,Math.min(1,i*i));var s=this.data.from+this.diff*i;this.el.setAttribute("sound","volume",s),1===i&&(this.fadeEnded=!0)}}})},function(t,e){function i(t,e){function i(t,e){return Math.floor(Math.random()*(e-t+1))+t}return[i(t.x,e.x),i(t.y,e.y),i(t.z,e.z)]}function s(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}function n(t){function e(t,e,i,s,n,o,a){var r=.5*(i-t),l=.5*(s-e);return(2*(e-i)+r+l)*a+(-3*(e-i)-2*r-l)*o+r*n+e}var i=new THREE.Spline(t);return i.getPointFrom=function(t,i){var s,n,o,a,r,l,h,c,d,u,m;return l=this.points,h=i+t,s=[],s[0]=0===i?i:i-1,s[1]=i,s[2]=i>l.length-2?l.length-1:i+1,s[3]=i>l.length-3?l.length-1:i+2,n=l[s[0]],o=l[s[1]],a=l[s[2]],r=l[s[3]],m=h-i,c=m*m,d=m*c,u={},u.x=e(n.x,o.x,a.x,r.x,m,c,d),u.y=e(n.y,o.y,a.y,r.y,m,c,d),u.z=e(n.z,o.z,a.z,r.z,m,c,d),u},i.getPointFrom=i.getPointFrom.bind(i),i}AFRAME.registerMovementPattern("random",{schema:{closed:{"default":!1},debug:{"default":!1},randomBoundsMin:{type:"vec3","default":{x:-10,y:0,z:-3}},randomBoundsMax:{type:"vec3","default":{x:10,y:10,z:-10}},randomNumPoints:{"default":4},restTime:{"default":1500},speed:{"default":3}},init:function(){var t,e,s,o,a,r=this.data,l=this.el;for(t=l.object3D.position,s=[[t.x,t.y,t.z]],e=0;e<r.randomNumPoints;e++)s.push(i(r.randomBoundsMin,r.randomBoundsMax));r.closed&&s.push([t.x,t.y,t.z]),o=this.spline=n(),o.initFromArray(s),this.currentPointIndex=0,a=o.getLength().chunks,this.cycleTimes=a.map(function(t,e){return 0===e?null:(t-a[e-1])/r.speed*1e3}).filter(function(t){return null!==t}),this.time=0,this.restTime=0},update:function(){var t=this.data,e=this.el;t.debug?e.setAttribute("spline-line",{pointer:"movement-pattern.movementPattern.spline"}):e.removeAttribute("spline-line")},tick:function(t,e){var i,n,o,a,r=this.data,l=this.el,h=this.restTime,c=this.spline;if(r.closed||this.currentPointIndex!==c.points.length-1){if(h&&r.restTime&&h>r.restTime)this.restTime=0;else if(h)return void(this.restTime+=e);if(i=this.cycleTimes[this.currentPointIndex],n=s(this.time%i/i),a=this.lastPercent<=1&&n>=0&&n<this.lastPercent){if(l.emit("waypointreached",{index:this.currentPointIndex,position:l.getAttribute("position")}),!r.closed&&this.currentPointIndex===c.points.length-1)return;
return this.lastPercent=0,this.time=0,this.restTime=1,void(this.currentPointIndex===c.points.length-2?this.currentPointIndex=0:this.currentPointIndex++)}this.time+=e,o=c.getPointFrom(n,this.currentPointIndex),l.setAttribute("position",{x:o.x,y:o.y,z:o.z}),this.lastPercent=n}}})},function(t,e){AFRAME.registerMovementPattern("toEntity",{schema:{debug:{"default":!1},target:{type:"selector"},speed:{"default":2}},init:function(){var t,e,i,s=this.data,n=this.el;return s.target.hasLoaded?(t=n.getComputedAttribute("position"),i=s.target.getComputedAttribute("position"),e=this.spline=new THREE.Spline,e.initFromArray([[t.x,t.y,t.z],[i.x,i.y,i.z],[t.x,t.y,t.z]]),void(this.cycleTime=e.getLength().total/s.speed*1e3)):void s.target.addEventListener("loaded",this.init.bind(this))},update:function(){var t=this.data,e=this.el;t.debug&&e.setAttribute("spline-line",{numPoints:5,pointer:"movement-pattern.movementPattern.spline"})},tick:function(t,e){var i,s=this.cycleTime,n=this.el,o=this.spline;o&&(i=o.getPoint(t%s/s),n.setAttribute("position",{x:i.x,y:i.y,z:i.z}))}})}]);